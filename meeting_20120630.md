## descent: 作業系統之前的程式 & x86 保護模式 ##
  * 報名頁面: http://registrano.com/events/mosut20120630
  * 摘要 (上半場)：探討使用 nasm (Intel 組合語言語法), gas (AT&T 語法), c 語言 (使用 gcc) 來撰寫作業系統之前的程式，就個別稱作 hello nasm, hello gas, hello world。如何使用這些 toolchain 來產生這樣的程式，並使用 bochs 內建的 debugger 來追蹤整個程式流程
  * 摘要 (下半場)：x86 保護模式，探討 gdt, descriptor, selector, segmented addressing，接續作業系統之前的程式並加入保護模式的程式碼，從 x86 真實模式切換到保護模式，觀察 C pointer 在真實模式和保護模式下的差異
  * 簡報: https://docs.google.com/open?id=0ByC_parZRMFtcUotSjIzSms1Nm8
    * keynote (only for MacOS X user):
```
git clone https://github.com/descent/latex_doc.git
cd keynote/bootloader_x86pm.key
```
  * 相關連結:
    * descent 筆記：http://descent-incoming.blogspot.com/2012/05/x86-bootloader-hello-world.html
    * x86 保護模式簡介: http://www.csie.ntu.edu.tw/~wcchen/asm98/asm/proj/b85506061/table_of_contents.html
    * 免費電子書：使用開源軟體-自己動手寫作業系統: http://share.solrex.org/WriteOS/index_cht.html
    * Real mode in C with gcc : writing a bootloader: http://dc0d32.blogspot.tw/2010/06/real-mode-in-c-with-gcc-writing.html
    * Why BIOS loads MBR into 0x7C00 in x86 ? http://www.glamenv-septzen.net/en/view/6
    * What I Dislike About GAS: http://x86asm.net/articles/what-i-dislike-about-gas/
  * 相關程式碼:
    * http://descent-incoming.blogspot.tw/2012/05/x86-bootloader-hello-world.html
```
git clone git@github.com:descent/simple_os.git
cd simple_os
git checkout origin/c-bootloader -b c-bootloader
cd c-bootloader/
```
    * simple\_os 的 branch origin/c-bootloader 是這次主題的程式碼。
  * 若想使用 bochs 內建除錯器的功能, 請參考這篇 (使用 bochs 內建除錯器來追蹤作業系統之前的程式)：
    * http://descent-incoming.blogspot.tw/2012/02/bochs-251-source-code.html
  * 《作業系統之前的技術》 / 萬德福 / 旗標出版
  * 電腦開機起來的第一隻程式: BIOS (0xffff:0X0000)
    * int 19 -> http://www.programmer-club.com.tw/showsametitlen/assembly/8988.html
  * BIOS 最後階段會：
    * 呼叫 INT19 -> 搜尋開機裝置 -> copy MBR 到 0:7C00 ->
    * 複製 MBR 程式到 0:6C00 -> 根據 partition table load  OS boot sector 到 0:7C00 ->
    * 控制權轉交 boot sector 程式 (JMP 0:7C00) -> boot to OS
  * 相關推薦，從 BIOS 工程師的角度，介紹 PC 硬體知識
    * 《以 C 語言解析電腦》
      * http://www.ptt.cc/bbs/C_and_CPP/M.1292343624.A.C03.html
  * 0:7C00 就是字面上的意思
  * 第一台 PC: IBM PC 5150
    * "The IBM Personal Computer, commonly known as the IBM PC, is the original version and progenitor of the IBM PC compatible hardware platform. It is IBM model number 5150, and was introduced on August 12, 1981."
    * http://en.wikipedia.org/wiki/IBM_Personal_Computer
  * Program #1: NASM
    * 透過 int 10h 中斷呼叫，印出字串
    * 產生的 bin 檔寫入 floppy 的前 512 bytes
    * hexdump 輸出
    * 最重要的結尾 0x55 0xaa
    * 用 QEMU 執行，也在真實機器驗證過：
      * http://descent-incoming.blogspot.tw/2012/05/x86-bootloader-hello-world.html
    * 真男人要用真的機器 (floppy++)
  * gas: AT&T 語法，得搭配 linker script (ld)
  * .code16 表示 16 bit code，雖可使用 32 bit register，但 prefix 不同
    * http://sunsite.ualberta.ca/Documentation/Gnu/binutils-2.9.1/html_node/as_204.html
    * "While GAS normally writes only "pure" 32-bit i386 code, it has limited support for writing code to run in real mode or in 16-bit protected mode code segments.  To do this, insert a `.code16' directive before the assembly language instructions to be run in 16-bit mode.  You can switch GAS back to writing normal 32-bit code with the `.code32' directive. "
  * 「學軟體的人需要知道輪子如何被打造」
  * 0xb8000: video memory
    * 參考: http://wiki.osdev.org/Printing_to_Screen
  * Program #2: gas
    * as.ld : 指定載入的位址到 0x7c00
    * 嘗試將 0x7c00 移到 0x7c04 (aligned?) -> 使得輸出的文字偏移
    * 原因：address jump 錯亂，計算與表示方式不同
  * PIC (position independent code) 可處理 library 層面的議題
  * C99 語法，需要指定 "gcc -std=c99"
```
 for (int i=0 ; i < 5 ; ++i)  { }
```
  * gcc (Ubuntu/Linaro 4.4.4-14ubuntu5) 4.4.5 實測
    * 使用 -std=c99 時，
```
  asm(".code16gcc\n");   /*  會產生錯誤 */
```
    * 得改用以下語法：
```
  __asm__ (".code16gcc\n"); /* 請改用 __asm__ */
```
  * 展示一段無法在實體機器執行的 hello cc 程式碼 (written in C)
    * 修改方式：正確設定 C runtime stack
    * 參見「20120611 補充 C 語言篇」
  * linker script 大法：指定尾端 0xaa55
    * AT(0x07DFE)
  * ELF 簡介
  * linker script 將 .rodata 指定到特定的 section，address: 0x7C59 (offset 0x59) 出現 "hello cc" 字樣，也就是字串存放的位址
  * 示範用 Bochs 追蹤
    * f000:fff0 存放 Bochs 自帶的 BIOS 程式碼，第一個指令就是：
```
    jmp far f000:e05b
```
    * 切換到 AT&T 語法：
```
 (bochs) u switch-mode
```
  * 示範 stepping，用 "n" 指令，右側會出現 assembly
  * magic\_break
    * http://descent-incoming.blogspot.tw/2012/05/bochs-magicbreak.html
    * 在 bochs 設定檔中:
```
    magic_break: enabled=1
```
    * 在程式中插入以下的 code:
```
    xchg %bx, %bx
```
    * bochs 會在執行這一行時中斷下來, 除錯的好利器。
  * 有了 Bochs，進步神速！
  * 「學東西最怕最後被淘汰」
  * EFI 會直接切到保護模式 -> boot loader 直接在保護模式運作！
  * 書籍：
    * 《80486/Pentium 保護模式原理與實務》
    * 《記憶體管理與多工》
    * Beyond EFI
      * http://www.intel.com/intelpress/sum_efi.htm
  * segmented address
    * 0x0000 + 0x7C00
    * A20 line -> 為了相容 1 MB 限制
    * CR0 register: 保護模式與真實模式之間的切換
    * http://wiki.osdev.org/Protected_Mode
  * 流程：
```
 CLI
 LGDT [GDTR]
 MOV EAX, CR0   ; 取出cr0原值
 OR AL, 1    　　  ; eax |= 1
 MOV CR0, EAX   ; cr0 = eax
 ; Immediately after that you have to jump to the code segment in the GDT:
 JMP 08h:PModeMain  ; PModeMain (code32)
```
  * G bit 的意義
    * 圖例可見 http://www.csie.ntu.edu.tw/~wcchen/asm98/asm/proj/b85506061/chap2/segment.html
  * 系統中有兩種 Descriptor Table：GDT（Global Descriptor Table）和 LDT（Local Descriptor Table）
    * 每個 Descriptor Table 可以存放 8192 個 Segment Descriptors。系統中一定要有一個 GDT，而 LDT 就可以有很多個，也可以不要 LDT。在系統中，GDT 可以被所有的程式和工作（task）所使用，而一個程式可能會有自己的 LDT
  * Program #3 設定保護模式
```
 lgdt gdt_ptr
 cli
#  open A20 line
# 設定 cr0 以切換到保護模式
movl %cr0, %eax
ljmpl $selector_mode, $seg_code32 ;; code32 (32-bit 保護模式程式碼進入點)
```
    * 可參考 http://voinici.ceata.org/~tct/resurse/utlk.pdf 第二章
```
 0xb8000 -> 'A'
 0xb8001 -> 0xC
 0xb8002 -> 'B'
 0xb8003 -> 0xc
```
  * 「C 語言從來就沒有直接讀寫特定位址的方式」
    * 解讀：考慮到 address mapping，C 指定的位址與實際位址不同
  * bochs 行為不同，無法執行，但真實機器卻可執行
  * OS 學習知識金字塔
  * Intel 手冊有五本
  * 「大真實模式」 -> http://b9215023.blogspot.tw/2008/05/big-real-mode.html
    * Microsoft 利用到 Intel 架構的 bug 來開發，所以 Intel 不得不保持相容性
  * 真實模式可以 access 32bit registers
    * http://wiki.osdev.org/Real_Mode
    * "Common Misconception:  Programmers often think that since Real Mode  defaults to 16 bits, that the 32 bit registers are not accessible. This  is not true. All of the 32-bit registers (EAX, ...) are still usable, by  simply adding the "Operand Size Override Prefix" (0x66) to the  beginning of any instruction. Your assembler is likely to do this for  you, if you simply try to use a 32-bit register. 16:16"


## ygtw: Sencha Touch: 跨平台網站的 HTML5 framework ##
  * http://www.sencha.com/products/touch
  * 簡介：
    * 開發網站要顧慮到跨平台一直都是一件麻煩的事情，以前是 PC 上處理IE/Chrome/Firefox/Safari，後來手機和平板又加入戰場，跨平台成了一件痛苦萬分的事。要單一自己的力量以 HTML5 開發出像 iOS / Android 有質感的互動介面更是一件不容易的事情，所幸有不少 framework 已漸漸成熟，讓我們能以幾行程式碼完成前端互動介面
    * Sencha Touch是一個發展一段時間且趨近穩定成熟的HTML5 framework，分享人將帶大家快速了解這個 framework 與相關資源
  * 超簡略簡報： http://www.slideshare.net/ssuser968e8d/sencha-touch-13500288
  * jQuery mobile (起步較早)
  * Sencha Touch -> 摸摸煎茶 (ygtw 自創翻譯)
  * 背後透過 ExtJS 來實做 -> 用 JavaScript 做出類似 iOS 的效果
  * 在 Android 上一堆問題
  * 完全不支援 IE (讚)
  * 不用 MVC
  * SASS
  * 類似 PhoneGap 包成 native APP
  * Sencha Touch 範例馬上玩
    * 必看範例! http://dev.sencha.com/deploy/touch/examples/production/kitchensink/
  * O'Reilly 2010 大會 APP 採用 Sencha Touch
  * 開發工具: Sencha Architect 2
  * Mitchell Simoens 撰寫的外掛
  * 在 Android 變成「笑能」，效能不彰
    * andy 立即拿出 HTC One S 手機，嘗試跑 Kitchen Sink 範例，不順暢
  * jQuery mobile 的開發工具: http://jquerymobile.com/
  * 另一個方案: jQtouch (更新太慢)
  * Sencha Touch 採用 GPL based open source project + support 商業模式
  * 可以呼叫 Android 上的 native service (透過包裝好的 JavaScript)


## 書本分享 ##
  * 《自己動手寫-Orange`s 一個作業系統的實現》
    * http://www.kingstone.com.tw/book/book_page.asp?kmcode=2013120121713
  * 《浪潮之顛》
    * http://www.books.com.tw/exep/prod/booksfile.php?item=0010541187
  * 《以 C 語言解析電腦》
    * http://www.ptt.cc/bbs/C_and_CPP/M.1292343624.A.C03.html
  * 《高通方程式》
    * http://blog.sina.com.cn/s/blog_5560fa9f0100037m.html
  * 《現在就開始學 HTML5》
    * http://www.books.com.tw/exep/prod/booksfile.php?item=0010538536

## CrBoy & float: 修改 ibus-chewing ##
  * 嘗試修正 ibus-chewing 在選取文字時，有時會將整個緩衝區消除的問題 (Ubuntu 12.04)
  * 在 Ubuntu 10.04 除了沒有一聲字不動的問題，就連切換輸入法會噴掉的問題都沒了，會不會跟 GTK+ 版本有關呢？


## 討論事項 ##
  * 如何彙整南台灣的電腦科技相關活動資訊？
    * 已知的南部的活動有 Study-Area, KaLUG, CocoaHeads: Kaohsiung, Code for Kaohsiung, KSDG，以及各資訊學系的分享交流活動。說來活動也不算少，但缺乏有效的呈現方式，讓更多人知曉
    * 南部活動分散，台北也是
    * Openfoundry 有集合一些活動
    * SA有加入台灣 Linux 日曆
    * 大家固定盯活動，兩個人分一個活動
    * 請各活動主辦人站出來，互相一起分享資訊
    * 學校活動有些頗封閉怕麻煩的公務員心態
  * MOSUT artwork
    * Marcus' 安平古堡：多數票同意
    * 可先提供簡報用的 32x32 icon，honki 預計 7/8 提供 SVG 版本
    * 歡迎貢獻其他 Artwork
  * Ardunio 團購簡介，預計在 7/14 前
  * 後續的分享題材
    * 議程盡量錯開，硬體/軟體/Web 等，保持多元性
    * 7/14
      * Arduino 硬體平台與應用領域介紹 (Marcus)
      * mini-talk: CodeIgniter (日落), 成大工科跟隨機器人
    * 7/28
      * USB 介面概念和 Linux USB library 相關分析運用 (cam11505)
      * CMS 比較分析 (yillkid)
    * 8/25
      * 林豪鏘 (國立臺南大學數位學習科技學系教授)
        * 運用情感運算於數位藝術之互動設計
  * workshop: 之前有朋友談到，可以舉辦類似 OpenLab Taipei 的活動，動手玩 Arduino, STM32 等等 open source 相關的項目，在固定聚會以外的週末或晚上時段
    * 目前有補習班教室可以開A rduino 的 workshop
    * 若有要辦相關活動，找到場地，自己上討論區揪團也可以
  * 下次討論網頁改版

## 簽到 ##
  * ygtw
  * Marcus
  * Sheng Kai Wang
  * cam11505
  * vic
  * descent
  * float
  * Axel Lin
  * jserv
  * Iris
  * CrBoy
  * airman
  * andyhorng
  * yillkid
  * goodtime
  * nylon7
  * a6a7